## Encode & Decode

LevelDB 的数据分为内存数据和磁盘数据，内存数据是当前的用户交互数据，保存在 Memtable 中；磁盘数据是持久化数据，保存在 SSTable 中。Memtable 中的数据达到一定数量，就会持久化生成SSTable，最终保存在磁盘上。    

<b>编码的必要性</b>
不论是内存数据，还是磁盘数据，出于便捷性、效率、占用空间等方面考虑，在数据存取时，通常都需要对数据进行一定格式的编码；同时计算机又存在大端、小端不同的数据存储方式，为了保证数据存储的统一性，兼容不同平台，也需要对数据进行编码。

<b>大端存储与小端存储</b>
一个多字节的数据，用逻辑表示时，从左到右，依次为高位到低位，如 0xaabbccff，最高位字节是aa，这也是在写代码或者文字表示一般都采用这种方式。而在计算机的角度，可以理解为数据在寄存器中的表示。  
用内存表示时，就是数据高低位字节在存储介质中的存放顺序，顺序的不同形成大小端两种字节序，如下所示：  
大端模式，高位字节存储在低位地址（数字小为低地址）：
<table>
<tr>
    <th>数据</th>
    <td>aa</td>
    <td>bb</td>
    <td>cc</td>
    <td>ff</td>
</tr>
<tr>
    <th>地址</th>
    <td>0x0010</td>
    <td>0x0011</td>
    <td>0x0012</td>
    <td>0x0013</td>
</tr>
</table>
小端模式，高位字节存储在地位地址：
<table>
<tr>
    <th>数据</th>
    <td>ff</td>
    <td>cc</td>
    <td>bb</td>
    <td>aa</td>
</tr>
<tr>
    <th>地址</th>
    <td>0x0010</td>
    <td>0x0011</td>
    <td>0x0012</td>
    <td>0x0013</td>
</tr>
</table>
    以上可以看出两种存储方式的不同。<b>在 leveldb 中统一都采用小端存储数据，也就是说如果平台采用的是大端模式，数据的编码操作会按小端模式进行编码，解码操作也会按小端模式解码。</b>

#### 分析

1. 整数编码   
对于整数，有定长整数与变长整数，。
- 定长整数
判断平台是否为小端模式，如果是小端，直接复制即可；如果是大端，进行数据字节序逆转 —— 每次提取一个字节，按小端字节序放置数据。

- 变长整数
采用 1bit(标志位) + 7bit(数据) 格式进行编码。   
标志位表示是否为最后一个字节，0表示结束，1表示还有其他字节；数据每次取7bit，从低位开始取，使用小端模式，也就是内存中第一个字节低7位对应数据0-6位，第二个字节低7位对应数据7-13位，以此类推。
按照此种方式编码，32位整数将使用1-5个字节编码，而64位整数将使用1-10个字节编码。

2. 字符串编码   
采用长度前缀编码。     
在字符串前添加长度信息，长度使用变长整数编码。如下：

#### 源码

#### 小结


#### PS：
- 编程技巧
  数据反向操作。